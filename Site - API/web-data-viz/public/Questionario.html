<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Questionario LD</title>
  <link rel="stylesheet" href="Style.css">
</head>
<link rel="icon" href="Imagens/Navbar/Logo.svg">

<body>


  <div class="navbar">
    <a href="./Index.html"><img src="Imagens/Navbar/Home.svg" alt="Ícone de menu Principal" class="Home icone"></a>
    <div class="navbar-center">
      <a href="./Index.html"><img src="Imagens/Navbar/Logo.svg" alt="Logo" class="Logo"></a>
      <p class="Titulo"><i>Leitura Descomplicada</i></p>
    </div>
    <a href="./Menu.html"><img src="Imagens/Navbar/More-outline.svg" alt="Ícone de menu de funcionalidades"
        class="Mais icone"></a>
    <a href="./Login.html"><img src="Imagens/Navbar/profile-outline.svg" alt="Ícone de Perfil" class="Perfil icone"></a>
  </div>


  <div class="todo">
    <div class="questionnaire">


      <button onclick="iniciar()" id="button_iniciar" class="button iniciar">Iniciar Questionario</button>

      <div class="Questionario" id="div_questionario" style="display: none; opacity: 0;">

        <div class="div_perguntas" id="div_perguntas">

          <p class="numero" id="p_numero"></p>
          <p class="Titulo" id="p_titulo"></p>
          <div class="opcoes">

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoA" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textA"></span>
            </label>

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoB" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textB"></span>
            </label>

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoC" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textC"></span>
            </label>

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoD" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textD"></span>
            </label>

          </div>
          <div class="botoes">
            <button onclick="anterior()" class="perguntaAnterior" id="perguntaAnterior" style="display: none;">&#8592; Pergunta
              anterior</button>
            <button onclick="finalizar()" style="display: none; grid-column: 2;" id="finalizarQuestionario"> Finalizar
              Questionario</button>
            <button onclick="proxima()" style="grid-column: 3;" id="perguntaProxima">Próxima pergunta &#8594;</button>
          </div>
        </div>

          <div class="questionarioFinalizado" id="div_questionarioFinalizado">
            <p class="respostaQuestionario" id="p_respostaQuestionario"></p>
          </div>
      </div>
    </div>
  </div>


  <div class="footer">

  <div class="card">
      <div class="cima">
        <p class="Titulo">Links rápidos</p>
        <p class="textoPrincipal">
          <a href="">•Home</a> <br>
          <a href="">•Dicas de leitura</a> <br>
          <a href="Menu.html">•Ferramentas</a>
        </p>
      </div>
  </div>
    <div class="vertical">
      <img src="Imagens/footer/LinhaVertical-footer.svg" alt="">
    </div>
    <div class="card">
      <div class="cima">
        <p class="Titulo">Contato</p>
        <p class="textoPrincipal">
          •Email <br>
          <a href="">•Formulário</a>
        </p>
      </div>
    </div>
    <div class="vertical2">
      <img src="Imagens/footer/LinhaVertical-footer.svg" alt="">
    </div>
    <div class="card">
      <div class="cima">
        <p class="Titulo">Sobre o projeto</p>
        <p class="textoPrincipal">
          •Desenvolvido por: <a href="https://www.linkedin.com/in/gabriel-furtado-165aa72bb/">Gabriel Furtado</a><br>
          •Instituição: <a href="https://sptech.school/">São Paulo tech school</a><br>
          <a
            href="https://bandteccom-my.sharepoint.com/:w:/g/personal/gabriel_dsousa_sptech_school/ETqZHxX_WZRAosnKsa7ZKWoBycfvJnAFzxgmrulGgwWgwA?e=OjjrFT">•Documentação
            do projeto</a>
        </p>
      </div>
    </div>
    <div class="horizontal"></div>
    <div class="baixo">
      <p class="disclaimer"> © 2025 Leitura Descomplicada - Todos os direitos reservados
        Projeto acadêmico desenvolvido para o curso de Ciências da Computação</p>
     </div>   
  </div>
</body>
<script>
  let perguntas = [
    'Que tipo de cenário te atrai mais em uma história?',
    'Qual dessas experiências você mais valoriza ao ler?',
    'Que tipo de personagem chama mais sua atenção?',
    'Quando você termina um livro, o que costuma ficar com você?',
    'Como você prefere que a história se desenrole?',
    'Que tipo de tema você considera mais envolvente?',
    'O que te motiva a escolher um livro?',
    'Que tipo de final mais te agrada?',
    'Qual é seu ritmo ideal de leitura?',
    'O que você espera sentir ao terminar um livro?'
  ];
  let opcoesA = [
    'Mundos futuristas e avanços tecnológicos',
    'Aprender algo novo sobre o mundo ou a sociedade',
    'Heróis com poderes ou jornadas épicas',
    'As ideias provocativas e os questionamentos',
    'Com ação constante e muitos eventos',
    'Tecnologia, ciência e ética',
    'A capa e o título chamativos',
    'Um desfecho inesperado e provocador',
    'Histórias rápidas e diretas',
    'Que aprendi algo relevante ou atual'
  ];

  let opcoesB = [
    'Reinos mágicos ou mitológicos',
    'Viver emoções intensas e relacionamentos marcantes',
    'Pessoas comuns enfrentando dilemas reais',
    'As emoções despertadas pela história',
    'Com foco no crescimento emocional dos personagens',
    'Amor, perda e superação',
    'A sinopse que me faz imaginar cenários e personagens',
    'Uma conclusão emocional e significativa',
    'Narrativas com tempo para refletir',
    'Que me conectei com os personagens'
  ];

  let opcoesC = [
    'Ambientes baseados em fatos reais ou históricos',
    'Refletir sobre questões existenciais e psicológicas',
    'Cientistas, exploradores ou visionários',
    'As lições de vida ou inspiração pessoal',
    'De forma investigativa, revelando aos poucos',
    'Cultura, tradições e eventos históricos',
    'O quanto o tema tem a ver com minha vida ou curiosidade',
    'Um final que fecha tudo com lógica',
    'Textos descritivos e ricos em contexto',
    'Que fui levado para outro mundo'
  ];

  let opcoesD = [
    'Espaços que despertam mistério ou tensão',
    'Ser surpreendido por reviravoltas ou revelações',
    'Figuras com segredos ou passado misterioso',
    'A vontade de reler por causa dos detalhes ocultos',
    'De forma informativa, baseada em fatos reais',
    'Medo, tensão e o lado sombrio do ser humano',
    'Indicações de pessoas ou plataformas que confio',
    'Um final em aberto que deixa espaço para pensar',
    'Depende do meu humor no momento',
    'Que fui desafiado a pensar de outro jeito'
  ];

  let respostas = []

  let indexDaVez = 0;

  let A = document.getElementById("label-textA")
  let B = document.getElementById("label-textB")
  let C = document.getElementById("label-textC")
  let D = document.getElementById("label-textD")

  let checkA = document.getElementById("opcaoA")
  let checkB = document.getElementById("opcaoB")
  let checkC = document.getElementById("opcaoC")
  let checkD = document.getElementById("opcaoD")

  let numeroExibido = document.getElementById("p_numero")
  let perguntaExibida = document.getElementById("p_titulo")

  let buttonPerguntaAnterior = document.getElementById("perguntaAnterior")
  let buttonPerguntaProxima = document.getElementById("perguntaProxima")
  let button_iniciar = document.getElementById("button_iniciar")
  let buttonFinalizarQuestionario = document.getElementById("finalizarQuestionario")

  let div_perguntas = document.getElementById("div_perguntas")
  let div_finalizar = document.getElementById("div_questionarioFinalizado")
  let respostaQuestionario = document.getElementById("p_respostaQuestionario")

  let generoUsuario = []

  function iniciar() {
    let divQuestionario = document.getElementById("div_questionario")


    button_iniciar.style.display = 'none'

    divQuestionario.style.opacity = '1'
    divQuestionario.style.display = 'grid'

    numeroExibido.innerHTML = '1/10'
    perguntaExibida.innerHTML = perguntas[0]

    A.innerHTML = opcoesA[0]
    B.innerHTML = opcoesB[0]
    C.innerHTML = opcoesC[0]
    D.innerHTML = opcoesD[0]
  }



  function proxima() {
    
    if (checkA.checked || checkB.checked || checkC.checked || checkD.checked){

      if (checkA.checked) {
        respostas.push(opcoesA[indexDaVez])
      } else if (checkB.checked) {
        respostas.push(opcoesB[indexDaVez])
      } else if (checkC.checked) {
        respostas.push(opcoesC[indexDaVez])
      } else if (checkD.checked) {
        respostas.push(opcoesD[indexDaVez])
      }
      
      if (indexDaVez < 9) {
        indexDaVez++
      }
      
      if (indexDaVez == 9) {
        buttonPerguntaProxima.style.display = 'none'
        buttonFinalizarQuestionario.style.display = 'grid';
      } else {
        buttonFinalizarQuestionario.style.display = 'none';
      }
      
      console.log(indexDaVez);
            
      numeroExibido.innerHTML = `${indexDaVez + 1}/10`
      perguntaExibida.innerHTML = perguntas[indexDaVez]
      
      A.innerHTML = opcoesA[indexDaVez]
      B.innerHTML = opcoesB[indexDaVez]
      C.innerHTML = opcoesC[indexDaVez]
      D.innerHTML = opcoesD[indexDaVez]
    
      limparChecks()
       
      console.log(respostas);

      if (indexDaVez != 0){
        buttonPerguntaAnterior.style.display = 'grid'
      }

    }else alert('Você precisa selecionar uma opção para avançar para próxima pergunta')

  }

  function limparChecks() {
    checkA.checked = false
    checkB.checked = false
    checkC.checked = false
    checkD.checked = false
  }

  function anterior() {


    //removendo a resposta
  
    respostas.splice(indexDaVez -1, 1)
    console.log(respostas);

    if (indexDaVez > 0) {
      indexDaVez--
    }
    console.log(indexDaVez);

    numeroExibido.innerHTML = `${indexDaVez + 1}/10`
    perguntaExibida.innerHTML = perguntas[indexDaVez]

    A.innerHTML = opcoesA[indexDaVez]
    B.innerHTML = opcoesB[indexDaVez]
    C.innerHTML = opcoesC[indexDaVez]
    D.innerHTML = opcoesD[indexDaVez]
    
    if(indexDaVez == 0){
      buttonPerguntaAnterior.style.display = 'none'
    } else buttonPerguntaAnterior.style.display = 'grid'
   
    if (indexDaVez == 9) {
        buttonPerguntaProxima.style.display = 'none'
        buttonFinalizarQuestionario.style.display = 'grid';
      } else {
        buttonFinalizarQuestionario.style.display = 'none';
        buttonPerguntaProxima.style.display = 'grid'
      }
      
    
  }

  function desmarcarOutros(checkboxSelecionado) {
    const checkboxes = document.querySelectorAll('input[name="opcao"]');
    checkboxes.forEach(cb => {
      if (cb !== checkboxSelecionado) cb.checked = false;
    });
  }

  function finalizar() {

    if (checkA.checked) {
      respostas.push(opcoesA[indexDaVez])
    } else if (checkB.checked) {
      respostas.push(opcoesB[indexDaVez])
    } else if (checkC.checked) {
      respostas.push(opcoesC[indexDaVez])
    } else if (checkD.checked) {
      respostas.push(opcoesD[indexDaVez])
    }

    console.log(respostas);
    

    div_perguntas.style.display = 'none'
    respostaQuestionario.innerHTML = `Questionario finalizado enviando resposta ao sistema...`

    //algoritmo pra identificar os generos favoritos do usuario
    algoritmoCalculoGeneroFavorito()
    console.log(algoritmoCalculoGeneroFavorito());

    let topGeneros = encontrarTopGeneros(pontuacao);
      console.log("Gênero 1:", topGeneros.genero1);
      console.log("Gênero 2:", topGeneros.genero2);

    respostaQuestionario.innerHTML = `De acordo com o algoritmo Leitura Descomplicada os generos que mais combinam com voce são:
    ${topGeneros.genero1} e ${topGeneros.genero2}`

    // enviando os dados dos generos favoritos para a API
    enviarQuestionarioAPI()
  }

 let pontuacao = {
    'Fantasia': 0,
    'Ficção Científica': 0,
    'Romance': 0,
    'Drama': 0,
    'Mistério': 0,
    'Terror': 0,
    'Distopia': 0,
    'Biografia': 0,
    'Não Ficção': 0,
    'Poesia': 0
  };

  function algoritmoCalculoGeneroFavorito() {
 

  const genero1 = ''
  const genero2 = ''

  for (let index = 0; index < respostas.length; index++) {
    if (respostas[index] == opcoesA[0]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesA[1]) {
      pontuacao['Não Ficção']++;
      pontuacao['Distopia']++;
    } else if (respostas[index] == opcoesA[2]) {
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesA[3]) {
      pontuacao['Distopia']++;
      pontuacao['Não Ficção']++; 
    } else if (respostas[index] == opcoesA[4]) {
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesA[5]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesA[7]) {
      pontuacao['Mistério']++;
      pontuacao['Distopia']++;
    } else if (respostas[index] == opcoesA[8]) {
      pontuacao['Não Ficção']++;
      pontuacao['Mistério']++; 
    } else if (respostas[index] == opcoesA[9]) {
      pontuacao['Não Ficção']++;
      pontuacao['Distopia']++;
    } else if (respostas[index] == opcoesB[0]) {
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesB[1]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[2]) {
      pontuacao['Drama']++;
      pontuacao['Biografia']++;
    } else if (respostas[index] == opcoesB[3]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[4]) {
      pontuacao['Drama']++; 
    } else if (respostas[index] == opcoesB[5]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[7]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[8]) {
      pontuacao['Drama']++;
      pontuacao['Não Ficção']++; 
    } else if (respostas[index] == opcoesB[9]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesC[0]) {
      pontuacao['Biografia']++;
    } else if (respostas[index] == opcoesC[1]) {
      pontuacao['Drama']++; 
      pontuacao['Poesia']++;
    } else if (respostas[index] == opcoesC[2]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesC[3]) {
      pontuacao['Biografia']++;
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesC[4]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesC[5]) {
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesC[7]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesC[8]) {
      pontuacao['Não Ficção']++;
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesC[9]) {
      pontuacao['Fantasia']++;
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesD[0]) {
      pontuacao['Mistério']++;
      pontuacao['Terror']++;
    } else if (respostas[index] == opcoesD[1]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesD[2]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesD[3]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesD[4]) {
      pontuacao['Biografia']++;
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesD[5]) {
      pontuacao['Terror']++;
      pontuacao['Mistério']++; 
    } else if (respostas[index] == opcoesD[7]) {
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesD[9]) {
      pontuacao['Não Ficção']++; 
      pontuacao['Poesia']++;
    }
  }
  console.log(pontuacao);
  

  encontrarTopGeneros(pontuacao)
}

function encontrarTopGeneros(pontuacao) {
  // convert o JSON pontuação em 2 vetores [genero] e [pontuação], formando um "par"
  const genreScores = Object.entries(pontuacao);

  // ordena os pares dos vetores criados baseados na quantidade de pontos(score)
  genreScores.sort(([, scoreA], [, scoreB]) => scoreB - scoreA);

  // pega os dois primeiros da lista (os dois maiores) e "corta" o resto fora
  const topTwoGenres = genreScores.slice(0, 2);

  let genero1 = topTwoGenres[0] ? topTwoGenres[0][0] : null;
  let genero2 = topTwoGenres[1] ? topTwoGenres[1][0] : null;

  return {genero1, genero2};


}

let topGeneros = encontrarTopGeneros(pontuacao);

  function enviarQuestionarioAPI(){
      


    const genero1 = topGeneros.genero1
    const genero2 = topGeneros.genero2

    if (genero1 == null || genero2 == null){
      respostaQuestionario.innerHTML = `<p style="color: red;"  class="erro">Por favor, preencha todos os campos!</p>`;
      
      
            setTimeout(() => {
            respostaQuestionario.innerHTML = ``
            }, 3000);
    return;
    } 

    const dadosParaApi = {
        "genero1Server": genero1,         // No controller: genero1
        "genero2Server": genero2,         // No controller: genero2
    };

    // Tentar a conversão para JSON e ver se há erros
    const jsonString = JSON.stringify(dadosParaApi);
    
    // Exibir os resultados
    console.log("Objeto original:", dadosParaApi);
    console.log("JSON convertido:", jsonString);

    console.log('Dados que serão enviados para a API:', dadosParaApi);
  
  // Modifique a URL se necessário para corresponder ao endpoint correto
  const urlApi = `http://localhost:3333/formularios/enviar`;
  
  // Exibir algum indicador de carregamento
  respostaQuestionario.innerHTML = `<p style="color: blue;" class="erro">Processando Mensagem...</p>`;
  
  fetch(urlApi, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(dadosParaApi) // Converte o objeto para uma string JSON
  })
  .then(response => {
    // Primeiro verifica se a resposta é ok
    if (!response.ok) {
      return response.json().then(erroApi => {
        const mensagemErro = erroApi.mensagem || `Erro ao enviar: ${response.status}`;
        throw new Error(mensagemErro);
      }).catch(error => {
        // Se não conseguir obter JSON, ainda mostra um erro genérico
        throw new Error(`Erro ao enviar: ${response.status}`);
      });
    }
    return response.json();
  })
  .then(data => {
    console.log("Sucesso do envio:", data);
    respostaQuestionario.innerHTML = `<p style="color: green;"  class="erro">${data.mensagem || "Questionario enviada com sucesso!"}</p>`;
    
    
    

  })
  .catch(error => {
    console.error("Erro geral no fetch:", error);
    respostaQuestionario.innerHTML = `<p style="color: red;"  class="erro">${error.message || "Ocorreu um erro ao mandar a mensagem. Tente novamente."}</p>`;
    
  });


  }


</script>

</html>