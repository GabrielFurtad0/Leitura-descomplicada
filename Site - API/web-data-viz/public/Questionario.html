<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Questionario LD</title>
  <link rel="stylesheet" href="Style.css">
</head>
<link rel="icon" href="Imagens/Navbar/novo_icone.svg" />

<body>


  <div class="todo">
      <div class="navbar relative">
        <div class="navbar-center">
          <a href="./Index.html"
            ><img src="Imagens/Navbar/novo_icone.svg" alt="Logo" class="Logo icone"
          /></a>
          <p class="Titulo"><i>Leitura Descomplicada</i></p>
        </div>
        <div class="perfil-mais">
        <a href="./Menu.html"
          ><img
            src="Imagens/Navbar/menu.svg"
            alt="Ícone de menu de funcionalidades"
            class="Mais icone"
        /></a>
        <div class="container-perfildeslogado" id="div_perfil">
          <a href="./Login.html"
          ><img
          src="Imagens/Navbar/perfil.svg"
          alt="Ícone de Perfil"
          class="Perfil icone"
          id="perfil"
          /></a>

          <div class="perfil-dropdown">
            <p class="nome-usuario" id="nickname" style="margin: 0.2rem; text-align: start;">Usuário</p>
            <p class="email-usuario" id="emailUser"  style="margin: 0.2rem; text-align: start;"></p>
            <button onclick="deslogar()" class="botao-logout" id="btn_logout">Finalizar sessão <img src="./Imagens/Navbar/logout.svg" alt="logout"></button>
          </div>
        </div>
        </div>
      </div>
    </div>


  <div class="todo">
    <div class="questionnaire" id="div_questionnaire">


      <button onclick="iniciar()" id="button_iniciar" class="button iniciar">Iniciar Questionario</button>

      <div class="Questionario" id="div_questionario" style="display: none; opacity: 0;">

        <div class="div_perguntas" id="div_perguntas">

          <p class="numero" id="p_numero"></p>
          <p class="Titulo" id="p_titulo"></p>
          <div class="opcoes">

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoA" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textA"></span>
            </label>

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoB" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textB"></span>
            </label>

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoC" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textC"></span>
            </label>

            <label class="opcao">
              <input type="checkbox" name="opcao" id="opcaoD" onclick="desmarcarOutros(this)">
              <span class="custom-checkbox">✔</span>
              <span class="label-text" id="label-textD"></span>
            </label>

          </div>
          <div class="botoes">
            <button onclick="anterior()" class="perguntaAnterior" id="perguntaAnterior" style="display: none;">&#8592; Pergunta
              anterior</button>
            <button onclick="finalizar()" style="display: none; grid-column: 2; font-size: 1.75rem;" id="finalizarQuestionario"> Finalizar
              Questionario</button>
            <button onclick="proxima()" style="grid-column: 3;" id="perguntaProxima">Próxima pergunta &#8594;</button>
          </div>
        </div>

          <div class="questionarioFinalizado" id="div_questionarioFinalizado">
            <p class="respostaQuestionario" id="p_respostaQuestionario"></p>
          </div>
          <div id="div_fotos" class="livroImagens" style="display: none;">
            <div class="genero">
              <p id="p_titulo1" class="titulo"></p>
              <div class="card">
                <img src="" alt="" id="img1.1" />
                <p class="subtitulo" id="p_subtitulo1.1"></p>
                <p class="descricao" id="p_descricao1.1">
                  
                </p>
                <button
                onclick="salvarLista1()"
                style="display: none"
                id="btn_lista1"
                class="btn_listaQ"
                >
                Salvar na minha lista
                </button>
                <p class="respostaCarrossel" id="p_respostaQuestionario2.1" style="display: none;">
              
                </p>
              </div>
              <div class="card margin-right">
                <img src="" alt="" id="img1.2"/>
                <p class="subtitulo" id="p_subtitulo1.2"></p>
                <p class="descricao" id="p_descricao1.2">
                  
                </p>
                <button
                onclick="salvarLista2()"
                style="display: none"
                id="btn_lista2"
                class="btn_listaQ"
                >
                Salvar na minha lista
                </button>
                <p class="respostaCarrossel" id="p_respostaQuestionario2.2" style="display: none;">
              
                </p>
              </div>
            </div>

            <div class="genero">
              <p id="p_titulo2" class="titulo"></p>
              <div class="card margin-left">
                <img src="" alt="" id="img2.1">
                <p class="subtitulo" id="p_subtitulo2.1"></p>
                <p class="descricao" id="p_descricao2.1">                  
                </p>
                <button
                onclick="salvarLista3()"
                style="display: none"
                id="btn_lista3"
                class="btn_listaQ"
                >
                Salvar na minha lista
                </button>
                <p class="respostaCarrossel" id="p_respostaQuestionario2.3" style="display: none;">
              
                </p>
              </div>
              <div class="card">
                <img src="" alt="" id="img2.2"/>
                <p class="subtitulo" id="p_subtitulo2.2"></p>
                <p class="descricao" id="p_descricao2.2">                  
                </p>
                <button
                onclick="salvarLista4()"
                style="display: none"
                id="btn_lista4"
                class="btn_listaQ"
                >
                Salvar na minha lista
                </button>
                <p class="respostaCarrossel" id="p_respostaQuestionario2.4" style="display: none;">
              
                </p>
              </div>
            </div>
          </div>
      </div>
    </div>
    <div class="div_btn-voltar" style="display: none;">
      <button class="voltar" onclick="window.location.href='./Menu.html'">
        <img src="./Imagens/Questionario/menu_open.svg" alt="">
      </button>
    </div>
  </div>


  <div class="footer">

  <div class="card">
      <div class="cima">
        <p class="Titulo">Links rápidos</p>
        <p class="textoPrincipal">
          <a href="./Index.html">•Home</a> <br>
          <a href="Menu.html">•Ferramentas</a>
        </p>
      </div>
  </div>
    <div class="vertical">
      <img src="Imagens/footer/LinhaVertical-footer.svg" alt="">
    </div>
    <div class="card">
      <div class="cima">
        <p class="Titulo">Contato</p>
          <a href="./Formulário.html">•Email</a><br>
          <a href="./Formulário.html">•Formulário</a>
        </p>
      </div>
    </div>
    <div class="vertical2">
      <img src="Imagens/footer/LinhaVertical-footer.svg" alt="">
    </div>
    <div class="card">
      <div class="cima">
        <p class="Titulo">Sobre o projeto</p>
        <p class="textoPrincipal">
          •Desenvolvido por: <a href="https://www.linkedin.com/in/gabriel-furtado-165aa72bb/">Gabriel Furtado</a><br>
          •Instituição: <a href="https://sptech.school/">São Paulo tech school</a><br>
          <a
            href="https://bandteccom-my.sharepoint.com/:w:/g/personal/gabriel_dsousa_sptech_school/ETqZHxX_WZRAosnKsa7ZKWoBycfvJnAFzxgmrulGgwWgwA?e=OjjrFT">•Documentação
            do projeto</a>
        </p>
      </div>
    </div>
    <div class="horizontal"></div>
    <div class="baixo">
      <p class="disclaimer"> © 2025 Leitura Descomplicada - Todos os direitos reservados
        Projeto acadêmico desenvolvido para o curso de Ciências da Computação</p>
     </div>   
  </div>
</body>
<script>
  window.onload = function(){
    iconePerfil()
  }

  function iconePerfil(){
    if (sessionStorage.getItem('ID_USUARIO')){
    const perfil = document.getElementById("perfil")
    const div_perfil = document.getElementById("div_perfil")
    const nickname = document.getElementById("nickname")
    const email = document.getElementById("emailUser")
      perfil.src="Imagens/Navbar/perfil-circulo.svg"
      div_perfil.classList.add("container-perfil")
      nickname.innerHTML = sessionStorage.getItem("NOME_USUARIO")
      email.innerHTML = sessionStorage.getItem("EMAIL_USUARIO")
    }else {
      alert('Para utilizar as funcionalidades do Leitura descomplicada você deve estar logado!')
      window.location.href = "./Login.html"
    }
  }


  function deslogar(){
    sessionStorage.clear()
    window.location.href = "./Login.html"
  }
</script>
<script>


  let perguntas = [
    'Que tipo de cenário te atrai mais em uma história?',
    'Qual dessas experiências você mais valoriza ao ler?',
    'Que tipo de personagem chama mais sua atenção?',
    'Quando você termina um livro, o que costuma ficar com você?',
    'Como você prefere que a história se desenrole?',
    'Que tipo de tema você considera mais envolvente?',
    'O que te motiva a escolher um livro?',
    'Que tipo de final mais te agrada?',
    'Qual é seu ritmo ideal de leitura?',
    'O que você espera sentir ao terminar um livro?'
  ];
  let opcoesA = [
    'Mundos futuristas e avanços tecnológicos',
    'Aprender algo novo sobre o mundo ou a sociedade',
    'Heróis com poderes ou jornadas épicas',
    'As ideias provocativas e os questionamentos',
    'Com ação constante e muitos eventos',
    'Tecnologia, ciência e ética',
    'A capa e o título chamativos',
    'Um desfecho inesperado e provocador',
    'Histórias rápidas e diretas',
    'Que aprendi algo relevante ou atual'
  ];

  let opcoesB = [
    'Reinos mágicos ou mitológicos',
    'Viver emoções intensas e relacionamentos marcantes',
    'Pessoas comuns enfrentando dilemas reais',
    'As emoções despertadas pela história',
    'Com foco no crescimento emocional dos personagens',
    'Amor, perda e superação',
    'A sinopse que me faz imaginar cenários e personagens',
    'Uma conclusão emocional e significativa',
    'Narrativas com tempo para refletir',
    'Que me conectei com os personagens'
  ];

  let opcoesC = [
    'Ambientes baseados em fatos reais ou históricos',
    'Refletir sobre questões existenciais e psicológicas',
    'Cientistas, exploradores ou visionários',
    'As lições de vida ou inspiração pessoal',
    'De forma investigativa, revelando aos poucos',
    'Cultura, tradições e eventos históricos',
    'O quanto o tema tem a ver com minha vida ou curiosidade',
    'Um final que fecha tudo com lógica',
    'Textos descritivos e ricos em contexto',
    'Que fui levado para outro mundo'
  ];

  let opcoesD = [
    'Espaços que despertam mistério ou tensão',
    'Ser surpreendido por reviravoltas ou revelações',
    'Figuras com segredos ou passado misterioso',
    'A vontade de reler por causa dos detalhes ocultos',
    'De forma informativa, baseada em fatos reais',
    'Medo, tensão e o lado sombrio do ser humano',
    'Indicações de pessoas ou plataformas que confio',
    'Um final em aberto que deixa espaço para pensar',
    'Depende do meu humor no momento',
    'Que fui desafiado a pensar de outro jeito'
  ];

  let respostas = []

  let indexDaVez = 0;
  
  let A = document.getElementById("label-textA")
  let B = document.getElementById("label-textB")
  let C = document.getElementById("label-textC")
  let D = document.getElementById("label-textD")
  
  let checkA = document.getElementById("opcaoA")
  let checkB = document.getElementById("opcaoB")
  let checkC = document.getElementById("opcaoC")
  let checkD = document.getElementById("opcaoD")

  let numeroExibido = document.getElementById("p_numero")
  let perguntaExibida = document.getElementById("p_titulo")

  let buttonPerguntaAnterior = document.getElementById("perguntaAnterior")
  let buttonPerguntaProxima = document.getElementById("perguntaProxima")
  let button_iniciar = document.getElementById("button_iniciar")
  let buttonFinalizarQuestionario = document.getElementById("finalizarQuestionario")

  let div_perguntas = document.getElementById("div_perguntas")
  let div_finalizar = document.getElementById("div_questionarioFinalizado")
  let respostaQuestionario = document.getElementById("p_respostaQuestionario")
  
  let generoUsuario = []

  let pontuacao = {
    'Fantasia': 0,
    'Ficção Científica': 0,
    'Romance': 0,
    'Drama': 0,
    'Mistério': 0,
    'Terror': 0,
    'Distopia': 0,
    'Biografia': 0,
    'Não Ficção': 0,
    'Poesia': 0
  };
 
  let imagensLivros = {
  "Fantasia": {
    "titulo1": "O Senhor dos Anéis",
    "titulo2": "Harry Potter e a Pedra Filosofal",
    "img_url1": "./Imagens/Questionario/O Senhor dos Anéis por J.R.R. Tolkien.jpg",
    "img_url2": "./Imagens/Questionario/Harry Potter e a Pedra Filosofal por J.K. Rowling.jpg",
    "resumo1": "Em uma terra mágica, hobbits, elfos e anões se unem para destruir um anel do poder e derrotar o Senhor do Escuro Sauron.",
    "resumo2": "Um jovem órfão descobre que é um bruxo e é convidado a estudar na Escola de Magia e Bruxaria de Hogwarts, onde enfrenta desafios e mistérios.",
  },
  "Ficção Científica": {
    "titulo1": "Duna",
    "titulo2": "1984",
    "img_url1": "./Imagens/Questionario/Dune by Frank Herbert.jpg",
    "img_url2": "./Imagens/Questionario/1984 by George Orwell.jpg",
    "resumo1": "Em um futuro distante, a luta pelo controle do planeta deserto Arrakis, a única fonte da valiosa especiaria melange, desencadeia uma teia de intrigas políticas e profecias messiânicas.",
    "resumo2": "Em um estado totalitário, Winston Smith se rebela contra o Partido e seu líder Big Brother, buscando a liberdade de pensamento e expressão.",
  },
  "Romance": {
    "titulo1": "Orgulho e Preconceito",
    "titulo2": "O Diário de Uma Paixão",
    "img_url1": "./Imagens/Questionario/Orgulho e Preconceito por Jane Austen_.jpg",
    "img_url2": "./Imagens/Questionario/O Diário de Uma Paixão por Nicholas Sparks.jpg",
    "resumo1": "A história acompanha Elizabeth Bennet enquanto lida com questões de moral, educação, ética e casamento na sociedade inglesa do século XIX.",
    "resumo2": "A história de amor entre Noah e Allie, separados por circunstâncias sociais, que se reencontram anos depois, mostrando a força e a durabilidade do verdadeiro amor.",
  },
  "Drama": {
    "titulo1": "O Grande Gatsby",
    "titulo2": "O Sol É Para Todos",
    "img_url1": "./Imagens/Questionario/O Grande Gatsby por F. Scott Fitzgerald.jpg",
    "img_url2": "./Imagens/Questionario/O Sol É Para Todos por Harper Lee.jpg",
    "resumo1": "Ambientado na Era do Jazz, o livro explora temas como riqueza, decadência, amor e ilusão através da vida misteriosa do milionário Jay Gatsby.",
    "resumo2": "Narrado pela perspectiva de uma criança, o romance aborda questões de racismo, injustiça e perda da inocência em uma pequena cidade do sul dos Estados Unidos.",
  },
  "Mistério": {
    "titulo1": "E Não Sobrou Nenhum",
    "titulo2": "Os Homens que Não Amavam as Mulheres",
    "img_url1": "./Imagens/Questionario/E Não Sobrou Nenhum por Agatha Christie.jpg",
    "img_url2": "./Imagens/Questionario/Os Homens que Não Amavam as Mulheres por Stieg Larsson (primeiro livro da série Millennium).jpg",
    "resumo1": "Dez estranhos são convidados para uma ilha e são assassinados um a um, seguindo os versos de uma sinistra canção de ninar.",
    "resumo2": "Um jornalista e uma investigadora se unem para desvendar o desaparecimento de uma jovem de uma rica família, expondo segredos sombrios e corrupção.",
  },
  "Terror": {
    "titulo1": "It: A Coisa",
    "titulo2": "Drácula",
    "img_url1": "./Imagens/Questionario/It A Coisa por Stephen King.jpg",
    "img_url2": "./Imagens/Questionario/61MgodE1s0L._AC_UF1000,1000_QL80_.jpg",
    "resumo1": "Um grupo de crianças se une para enfrentar Pennywise, um palhaço maligno que aterroriza sua cidade a cada 27 anos, explorando seus medos mais profundos.",
    "resumo2": "A história clássica do vampiro Conde Drácula e sua busca por sangue e imortalidade, combatido por um grupo determinado a destruí-lo.",
  },
  "Distopia": {
    "titulo1": "Jogos Vorazes",
    "titulo2": "Fahrenheit 451",
    "img_url1": "./Imagens/Questionario/Jogos Vorazes por Suzanne Collins.jpg",
    "img_url2": "./Imagens/Questionario/Fahrenheit 451 por Ray Bradbury.jpg",
    "resumo1": "Em um futuro onde os distritos são forçados a enviar tributos para lutar em jogos mortais televisionados, Katniss Everdeen se torna um símbolo de rebelião.",
    "resumo2": "Em uma sociedade onde os livros são proibidos e queimados, um bombeiro começa a questionar seu papel e busca conhecimento em obras literárias.",
  },
  "Biografia": {
    "titulo1": "O Diário de Anne Frank",
    "titulo2": "Steve Jobs",
    "img_url1": "./Imagens/Questionario/O Diário de Anne Frank por Anne Frank.jpg",
    "img_url2": "./Imagens/Questionario/Steve Jobs por Walter Isaacson.jpg",
    "resumo1": "O relato pessoal de uma jovem judia escondida dos nazistas durante a Segunda Guerra Mundial, oferecendo uma visão íntima de seus medos, esperanças e amadurecimento.",
    "resumo2": "A biografia autorizada do cofundador da Apple, explorando sua vida pessoal e profissional, sua genialidade e sua personalidade complexa.",
  },
  "Não Ficção": {
    "titulo1": "Sapiens: Uma Breve História da Humanidade",
    "titulo2": "Os 7 Hábitos das Pessoas Altamente Eficazes",
    "img_url1": "./Imagens/Questionario/Sapiens Uma Breve História da Humanidade por Yuval Noah Harari.jpg",
    "img_url2": "./Imagens/Questionario/Os 7 Hábitos das Pessoas Altamente Eficazes por Stephen R. Covey.jpg",
    "resumo1": "Uma análise abrangente da história da humanidade, desde os primeiros humanos até o presente, explorando o impacto da nossa espécie no planeta.",
    "resumo2": "Um guia de desenvolvimento pessoal que apresenta sete princípios para alcançar a eficácia em diversas áreas da vida, tanto pessoal quanto profissional.",
  },
  "Poesia": {
    "titulo1": "As Obras Completas de William Shakespeare",
    "titulo2": "Folhas de Relva",
    "img_url1": "./Imagens/Questionario/As Obras Completas de William Shakespeare.jpg",
    "img_url2": "./Imagens/Questionario/Folhas de Relva por Walt Whitman.jpg",
    "resumo1": "Uma coleção de todas as peças, sonetos e poemas do renomado dramaturgo e poeta inglês, explorando uma vasta gama de temas e emoções humanas.",
    "resumo2": "Uma obra revolucionária da poesia americana, celebrando a natureza, o corpo humano, a democracia e a individualidade com uma linguagem inovadora e ousada.",
  }
}

  let tamanhoLeituraHoras = {
  "Fantasia": {
    "titulo1_tempo": 12, // O Senhor dos Anéis - leitura mais longa e complexa
    "titulo2_tempo": 5,  // Harry Potter e a Pedra Filosofal - leitura mais acessível
  },
  "Ficção Científica": {
    "titulo1_tempo": 8,  // Duna - leitura complexa com muitos detalhes
    "titulo2_tempo": 6,  // 1984 - leitura de complexidade média
  },
  "Romance": {
    "titulo1_tempo": 7,  // Orgulho e Preconceito - linguagem clássica
    "titulo2_tempo": 4,  // O Diário de Uma Paixão - leitura mais fluida
  },
  "Drama": {
    "titulo1_tempo": 5,  // O Grande Gatsby - tamanho médio
    "titulo2_tempo": 6,  // O Sol É Para Todos - leitura reflexiva
  },
  "Mistério": {
    "titulo1_tempo": 5,  // E Não Sobrou Nenhum - ritmo ágil
    "titulo2_tempo": 7,  // Os Homens que Não Amavam as Mulheres - mais denso
  },
  "Terror": {
    "titulo1_tempo": 10, // It: A Coisa - livro extenso
    "titulo2_tempo": 6,  // Drácula - linguagem clássica
  },
  "Distopia": {
    "titulo1_tempo": 5,  // Jogos Vorazes - leitura fluida
    "titulo2_tempo": 4,  // Fahrenheit 451 - livro mais curto
  },
  "Biografia": {
    "titulo1_tempo": 4,  // O Diário de Anne Frank - tamanho médio
    "titulo2_tempo": 9,  // Steve Jobs - biografia extensa
  },
  "Não Ficção": {
    "titulo1_tempo": 8,  // Sapiens: Uma Breve História da Humanidade - denso
    "titulo2_tempo": 6,  // Os 7 Hábitos das Pessoas Altamente Eficazes - leitura técnica
  },
  "Poesia": {
    "titulo1_tempo": 15, // As Obras Completas de William Shakespeare - muito extenso
    "titulo2_tempo": 5,  // Folhas de Relva - leitura poética que requer reflexão
  }
};

  let genero1 = ''
  let genero2 = ''

  function iniciar() {
   const id = sessionStorage.getItem("ID_USUARIO") || null;
    if (id == null){
      alert('Você precisa estar logado para fazer o quiz!')

    }else{

      
      let divQuestionario = document.getElementById("div_questionario")
      
      
      button_iniciar.style.display = 'none'
      
      divQuestionario.style.opacity = '1'
      divQuestionario.style.display = 'grid'
      
      numeroExibido.innerHTML = '1/10'
      perguntaExibida.innerHTML = perguntas[0]
      
      A.innerHTML = opcoesA[0]
      B.innerHTML = opcoesB[0]
      C.innerHTML = opcoesC[0]
      D.innerHTML = opcoesD[0]
      }
    }
 
  function proxima() {
      
      if (checkA.checked || checkB.checked || checkC.checked || checkD.checked){
        
        if (checkA.checked) {
          respostas.push(opcoesA[indexDaVez])
      } else if (checkB.checked) {
        respostas.push(opcoesB[indexDaVez])
      } else if (checkC.checked) {
        respostas.push(opcoesC[indexDaVez])
      } else if (checkD.checked) {
        respostas.push(opcoesD[indexDaVez])
      }
      
      if (indexDaVez < 9) {
        indexDaVez++
      }
      
     

        if (indexDaVez == 9) {
          buttonPerguntaProxima.style.display = 'none'
          buttonFinalizarQuestionario.style.display = 'grid';
        } else {
          buttonFinalizarQuestionario.style.display = 'none';
        }
      
      
      console.log(indexDaVez);
            
      numeroExibido.innerHTML = `${indexDaVez + 1}/10`
      perguntaExibida.innerHTML = perguntas[indexDaVez]
      
      A.innerHTML = opcoesA[indexDaVez]
      B.innerHTML = opcoesB[indexDaVez]
      C.innerHTML = opcoesC[indexDaVez]
      D.innerHTML = opcoesD[indexDaVez]
    
      limparChecks()
       
      console.log(respostas);

      if (indexDaVez != 0){
        buttonPerguntaAnterior.style.display = 'grid'
      }

    }else alert('Você precisa selecionar uma opção para avançar para próxima pergunta')

  }

  function limparChecks() {
    checkA.checked = false
    checkB.checked = false
    checkC.checked = false
    checkD.checked = false
  }

  function anterior() {


    //removendo a resposta
  
    respostas.splice(indexDaVez -1, 1)
    console.log(respostas);
    limparChecks()

    if (indexDaVez > 0) {
      indexDaVez--
    }
    console.log(indexDaVez);

    numeroExibido.innerHTML = `${indexDaVez + 1}/10`
    perguntaExibida.innerHTML = perguntas[indexDaVez]

    A.innerHTML = opcoesA[indexDaVez]
    B.innerHTML = opcoesB[indexDaVez]
    C.innerHTML = opcoesC[indexDaVez]
    D.innerHTML = opcoesD[indexDaVez]
    
    if(indexDaVez == 0){
      buttonPerguntaAnterior.style.display = 'none'
    } else buttonPerguntaAnterior.style.display = 'grid'
   
    if (indexDaVez == 9) {
        buttonPerguntaProxima.style.display = 'none'
        buttonFinalizarQuestionario.style.display = 'grid';
      } else {
        buttonFinalizarQuestionario.style.display = 'none';
        buttonPerguntaProxima.style.display = 'grid'
      }
      
  }

  function desmarcarOutros(checkboxSelecionado) {
    const checkboxes = document.querySelectorAll('input[name="opcao"]');
    checkboxes.forEach(cb => {
      if (cb !== checkboxSelecionado) cb.checked = false;
    });
  }

  function finalizar() {
    
     if (checkA.checked || checkB.checked || checkC.checked || checkD.checked){

       if (checkA.checked) {
         respostas.push(opcoesA[indexDaVez])
        } else if (checkB.checked) {
          respostas.push(opcoesB[indexDaVez])
        } else if (checkC.checked) {
          respostas.push(opcoesC[indexDaVez])
        } else if (checkD.checked) {
          respostas.push(opcoesD[indexDaVez])
        }
        
        console.log(respostas);

        const buttons = document.querySelectorAll('.btn_listaQ');
        buttons.forEach(button => {
          button.style.display = 'block';
        });
        
        // Mudanças no display para mostrar a finalização do questionario
        div_perguntas.style.display = 'none'
        respostaQuestionario.innerHTML = `Questionario finalizado enviando resposta ao sistema...`
        div_questionario.style.height = 'fit-content'
        div_fotos.style.display = 'grid'
        div_questionnaire.style.marginBottom = '10rem'
        document.querySelector('.div_btn-voltar').style.display = 'grid'
        
        //algoritmo pra identificar os generos favoritos do usuario
        algoritmoCalculoGeneroFavorito()
        console.log(algoritmoCalculoGeneroFavorito());
        
        let topGeneros = encontrarTopGeneros(pontuacao);
        console.log("Gênero 1:", topGeneros.genero1);
        console.log("Gênero 2:", topGeneros.genero2);
        
        respostaQuestionario.innerHTML = `De acordo com o algoritmo Leitura Descomplicada os gêneros que mais combinam com voce são:
        ${topGeneros.genero1} e ${topGeneros.genero2}`
        
        // enviando os dados dos generos favoritos para a API
        enviarQuestionarioAPI()
      }else alert('Você precisa selecionar uma opção para avançar para finalizar o questionario!')
  }

  function algoritmoCalculoGeneroFavorito() {
 

  const genero1 = ''
  const genero2 = ''

  for (let index = 0; index < respostas.length; index++) {
    if (respostas[index] == opcoesA[0]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesA[1]) {
      pontuacao['Não Ficção']++;
      pontuacao['Distopia']++;
    } else if (respostas[index] == opcoesA[2]) {
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesA[3]) {
      pontuacao['Distopia']++;
      pontuacao['Não Ficção']++; 
    } else if (respostas[index] == opcoesA[4]) {
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesA[5]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesA[7]) {
      pontuacao['Mistério']++;
      pontuacao['Distopia']++;
    } else if (respostas[index] == opcoesA[8]) {
      pontuacao['Não Ficção']++;
      pontuacao['Mistério']++; 
    } else if (respostas[index] == opcoesA[9]) {
      pontuacao['Não Ficção']++;
      pontuacao['Distopia']++;
    } else if (respostas[index] == opcoesB[0]) {
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesB[1]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[2]) {
      pontuacao['Drama']++;
      pontuacao['Biografia']++;
    } else if (respostas[index] == opcoesB[3]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[4]) {
      pontuacao['Drama']++; 
    } else if (respostas[index] == opcoesB[5]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[7]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesB[8]) {
      pontuacao['Drama']++;
      pontuacao['Não Ficção']++; 
    } else if (respostas[index] == opcoesB[9]) {
      pontuacao['Romance']++;
      pontuacao['Drama']++;
    } else if (respostas[index] == opcoesC[0]) {
      pontuacao['Biografia']++;
    } else if (respostas[index] == opcoesC[1]) {
      pontuacao['Drama']++; 
      pontuacao['Poesia']++;
    } else if (respostas[index] == opcoesC[2]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesC[3]) {
      pontuacao['Biografia']++;
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesC[4]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesC[5]) {
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesC[7]) {
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesC[8]) {
      pontuacao['Não Ficção']++;
      pontuacao['Fantasia']++;
    } else if (respostas[index] == opcoesC[9]) {
      pontuacao['Fantasia']++;
      pontuacao['Ficção Científica']++;
    } else if (respostas[index] == opcoesD[0]) {
      pontuacao['Mistério']++;
      pontuacao['Terror']++;
    } else if (respostas[index] == opcoesD[1]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesD[2]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesD[3]) {
      pontuacao['Mistério']++;
    } else if (respostas[index] == opcoesD[4]) {
      pontuacao['Biografia']++;
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesD[5]) {
      pontuacao['Terror']++;
      pontuacao['Mistério']++; 
    } else if (respostas[index] == opcoesD[7]) {
      pontuacao['Não Ficção']++;
    } else if (respostas[index] == opcoesD[9]) {
      pontuacao['Não Ficção']++; 
      pontuacao['Poesia']++;
    }
  }
  console.log(pontuacao);
  

  encontrarTopGeneros(pontuacao)
}

function encontrarTopGeneros(pontuacao) {
  // convert o JSON pontuação em 2 vetores [genero] e [pontuação], formando um "par"
  const genreScores = Object.entries(pontuacao);

  // ordena os pares dos vetores criados baseados na quantidade de pontos(score)
  genreScores.sort(([, scoreA], [, scoreB]) => scoreB - scoreA);

  // pega os dois primeiros da lista (os dois maiores) e "corta" o resto fora
  const topTwoGenres = genreScores.slice(0, 2);

  genero1 = topTwoGenres[0] ? topTwoGenres[0][0] : null;
  genero2 = topTwoGenres[1] ? topTwoGenres[1][0] : null;

  return {genero1, genero2};


}

  function enviarQuestionarioAPI(){
    let topGeneros = encontrarTopGeneros(pontuacao);
     const genero1 = topGeneros.genero1
     const genero2 = topGeneros.genero2
  
    const id = sessionStorage.getItem("ID_USUARIO") || null;

    const divResposta = document.getElementById("p_respostaQuestionario")
    

    // declaração para a exibição no final questionario
    const p_titulo1 = document.getElementById("p_titulo1");
    const p_titulo2 = document.getElementById("p_titulo2");
    const p_subtitulo1_1 = document.getElementById("p_subtitulo1.1");
    const p_subtitulo1_2 = document.getElementById("p_subtitulo1.2");
    const p_subtitulo2_1 = document.getElementById("p_subtitulo2.1");
    const p_subtitulo2_2 = document.getElementById("p_subtitulo2.2");
    const p_descricao1_1 = document.getElementById("p_descricao1.1");
    const p_descricao1_2 = document.getElementById("p_descricao1.2");
    const p_descricao2_1 = document.getElementById("p_descricao2.1");
    const p_descricao2_2 = document.getElementById("p_descricao2.2");
    const img1_1 = document.getElementById("img1.1");
    const img1_2 = document.getElementById("img1.2");
    const img2_1 = document.getElementById("img2.1");
    const img2_2 = document.getElementById("img2.2");

    const dadosParaApi = {
        "genero1Server": genero1,         // No controller: genero1
        "genero2Server": genero2,         // No controller: genero2
        "idServer": id,
    };

    // Tentar a conversão para JSON e ver se há erros
    const jsonString = JSON.stringify(dadosParaApi);
    
    
    console.log("Objeto original:", dadosParaApi);
    console.log("JSON convertido:", jsonString);

    console.log('Dados que serão enviados para a API:', dadosParaApi);
  
  
  const urlApi = `http://localhost:3333/questionarios/enviar`;
  
  // Exibir algum indicador de carregamento
  divResposta.innerHTML = `<p style="color: blue;" class="erro">Processando Mensagem...</p>`;
  
  fetch(urlApi, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(dadosParaApi) // Converte o objeto para uma string JSON
  })
  .then(response => {
    // Primeiro verifica se a resposta é ok
    if (!response.ok) {
      return response.json().then(erroApi => {
        const mensagemErro = erroApi.mensagem || `Erro ao enviar: ${response.status}`;
        throw new Error(mensagemErro);
      }).catch(error => {
        // Se não conseguir obter JSON, ainda mostra um erro genérico
        throw new Error(`Erro ao enviar: ${response.status}`);
      });
    }
    return response.json();
  })
  .then(data => {
    console.log("Sucesso do cadastro:", data);
    divResposta.innerHTML = `${data.mensagem || `Os gêneros que mais combinam com você são:`}`;    

    p_titulo1.innerHTML = `${genero1}`

    p_subtitulo1_1.innerHTML = imagensLivros[genero1].titulo1
    p_descricao1_1.innerHTML = imagensLivros[genero1].resumo1
    img1_1.src = imagensLivros[genero1].img_url1
    img1_1.alt = imagensLivros[genero1].titulo1

    p_subtitulo1_2.innerHTML = imagensLivros[genero1].titulo2  
    p_descricao1_2.innerHTML = imagensLivros[genero1].resumo2
    img1_2.src = imagensLivros[genero1].img_url2
    img1_2.alt = imagensLivros[genero1].titulo2

    p_titulo2.innerHTML = `${genero2}`

    p_subtitulo2_1.innerHTML = imagensLivros[genero2].titulo1
    p_descricao2_1.innerHTML = imagensLivros[genero2].resumo1
    img2_1.src = imagensLivros[genero2].img_url1
    img2_1.alt = imagensLivros[genero2].titulo1

    p_subtitulo2_2.innerHTML = imagensLivros[genero2].titulo2    
    p_descricao2_2.innerHTML = imagensLivros[genero2].resumo2    
    img2_2.src = imagensLivros[genero2].img_url2    
    img2_2.alt = imagensLivros[genero2].titulo2

  })
  .catch(error => {
    console.error("Erro geral no fetch:", error);
    console.error("Erro geral no fetch:", error);
    if (error.message == 'Erro ao enviar: 500'){
      divResposta.innerHTML = `<p style="color: red;" class="erro">Este livro ja está na sua lista!</p>`
    }else 
    divResposta.innerHTML = `<p style="color: red;"  class="erro">"Ocorreu um erro ao adicionar esse livro a sua lista. Tente novamente mais tarde, ou, mande uma mensagem para nós através do formulário."
    </p>`;

  });
}
  
  let adicionarLista = {
      "genero": "", 
      "titulo1": "",
      "img_url1": "",
      "resumo1": "",
    }

  let botaoSalvarLista = ''
  
  let divResposta = ''

  function salvarLista1(){
    adicionarLista = {
    "genero": genero1, 
    "titulo1": imagensLivros[genero1].titulo1,
    "img_url1": imagensLivros[genero1].img_url1,
    "resumo1": imagensLivros[genero1].resumo1,
    "tempoLeitura":tamanhoLeituraHoras[genero1].titulo1_tempo
  }
    botaoSalvarLista = document.getElementById('btn_lista1')
    divResposta = document.getElementById("p_respostaQuestionario2.1")
    salvarLista()
  }

  function salvarLista2(){
    adicionarLista = {
    "genero": genero1, 
    "titulo1": imagensLivros[genero1].titulo2,
    "img_url1": imagensLivros[genero1].img_url2,
    "resumo1": imagensLivros[genero1].resumo2,
    "tempoLeitura":tamanhoLeituraHoras[genero1].titulo2_tempo
  }
    botaoSalvarLista = document.getElementById('btn_lista2')
    divResposta = document.getElementById("p_respostaQuestionario2.2")
    salvarLista()
  }

  function salvarLista3(){
    adicionarLista = {
    "genero": genero2, 
    "titulo1": imagensLivros[genero2].titulo1,
    "img_url1": imagensLivros[genero2].img_url1,
    "resumo1": imagensLivros[genero2].resumo1,
    "tempoLeitura":tamanhoLeituraHoras[genero2].titulo1_tempo
  }
    botaoSalvarLista = document.getElementById('btn_lista3')
    divResposta = document.getElementById("p_respostaQuestionario2.3")
    salvarLista()
  }

  function salvarLista4(){
    adicionarLista = {
    "genero": genero2, 
    "titulo1": imagensLivros[genero2].titulo2,
    "img_url1": imagensLivros[genero2].img_url2,
    "resumo1": imagensLivros[genero2].resumo2,
    "tempoLeitura":tamanhoLeituraHoras[genero2].titulo2_tempo
  }
    botaoSalvarLista = document.getElementById('btn_lista4')
    divResposta = document.getElementById("p_respostaQuestionario2.4")
    salvarLista()
  }


  function salvarLista(){
    let tituloParagrafo = adicionarLista.titulo1
    let imagemLivro = adicionarLista.img_url1
    let genero = adicionarLista.genero
    let descricao = adicionarLista.resumo1
    let tempoLeitura = adicionarLista.tempoLeitura
    
    

    const id = sessionStorage.getItem("ID_USUARIO") || null;

    if (id == null){
      alert ('Você precisa estar logado para adicionar este livro a sua lista!')
      window.location.href = "./Login.html";
    }else{     

      divResposta.style.display = 'inline'

    const dadosParaApi = {      
        "tituloParagrafoServer": tituloParagrafo,
        "imagemLivroServer": imagemLivro,                                
        "generoServer": genero,
        "descricaoServer": descricao,
        "tempoLeituraServer": tempoLeitura,
        "idServer": id,
    };

    
    const jsonString = JSON.stringify(dadosParaApi);
    
    
    console.log("Objeto original:", dadosParaApi);
    console.log("JSON convertido:", jsonString);

    console.log('Dados que serão enviados para a API:', dadosParaApi);
  
  
  const urlApi = `http://localhost:3333/favoritos/enviar`;
  
  
  divResposta.innerHTML = `<p style="color: blue;" class="erro">Processando Mensagem...</p>`;
  
  fetch(urlApi, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(dadosParaApi) // Converte o objeto para uma string JSON
  })
  .then(response => {
    // Primeiro verifica se a resposta é ok
    if (!response.ok) {
      return response.json().then(erroApi => {
        const mensagemErro = erroApi.mensagem || `Erro ao enviar: ${response.status}`;
        throw new Error(mensagemErro);
      }).catch(error => {
        // Se não conseguir obter JSON, ainda mostra não tratado
        throw new Error(`Erro ao enviar: ${response.status}`);
      });
    }
    return response.json();
  })
  .then(data => {
    console.log("Sucesso do cadastro:", data);
    divResposta.innerHTML = `<p style="color: green;"  class="erro">${data.mensagem || "Adicionado a sua lista com sucesso!"}</p>`;
              
         botaoSalvarLista.style.borderColor = "#6fde73"
      
            setTimeout(() => {
  
            botaoSalvarLista.style.borderColor = "#a67c52";
            
            }, 3000);
    
    

  })
  .catch(error => {
    if (error.message == "Erro ao enviar: 500"){
      error.mensagem = "Este livro já está na sua lista!"
    }
    console.error("Erro geral no fetch:", error);
    divResposta.innerHTML = `<p style="color: red;"  class="erro">Este livro já está na sua lista!</p>`;
    
  });
}
}

function menu(){
  window.location.href = "Menu.html"
}


</script>

</html>