<!DOCTYPE html>
<html lang="PT-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carrossel</title>
    <link rel="stylesheet" href="Style.css" />
  </head>
  <link rel="icon" href="Imagens/Navbar/novo_icone.svg" />

  <body>
    <div class="todo">
      <div class="navbar relative">
        <div class="navbar-center ">
          <a href="./Index.html"
            ><img src="Imagens/Navbar/novo_icone.svg" alt="Logo" class="Logo icone"
          /></a>
          <p class="Titulo"><i>Leitura Descomplicada</i></p>
        </div>
        <div class="perfil-mais">
        <a href="./Menu.html"
          ><img
            src="Imagens/Navbar/menu.svg"
            alt="Ícone de menu de funcionalidades"
            class="Mais icone"
        /></a>
        <div class="container-perfildeslogado" id="div_perfil">
          <a href="./Login.html"
          ><img
          src="Imagens/Navbar/perfil.svg"
          alt="Ícone de Perfil"
          class="Perfil icone"
          id="perfil"
          /></a>

          <div class="perfil-dropdown">
            <p class="nome-usuario" id="nickname" style="margin: 0.2rem; text-align: start;">Usuário</p>
            <p class="email-usuario" id="emailUser"  style="margin: 0.2rem; text-align: start;"></p>
            <button onclick="deslogar()" class="botao-logout" id="btn_logout">Finalizar sessão <img src="./Imagens/Navbar/logout.svg" alt="logout"></button>
          </div>
        </div>
        </div>
      </div>
    </div>

    <div class="todo">
      <div class="carrossel">
        <button onclick="sorteio()" id="botao">Sortear</button>
        <div class="cardCarrossel" id="cardCarrossel">
          <p class="Titulo" id="p_Titulo"></p>
          <img src="" alt="" id="img_livro" />
          <p class="subtitulo" id="p_subtitulo"></p>
          <p class="descricao" id="p_descricao"></p>
          <button
            onclick="salvarLista()"
            style="display: none"
            id="btn_lista"
            class="btn_lista"
          >
            Salvar na minha lista
          </button>
           <p class="respostaCarrossel" id="p_respostaQuestionario">
              
            </p>
          <p class="descricao" id="p_tempoLeituraHoras"></p>
        </div>
      </div>
    </div>

    <div class="footer">

  <div class="card">
      <div class="cima">
        <p class="Titulo">Links rápidos</p>
        <p class="textoPrincipal">
          <a href="./Index.html">•Home</a> <br>
          <a href="Menu.html">•Ferramentas</a>
        </p>
      </div>
  </div>
    <div class="vertical">
      <img src="Imagens/footer/LinhaVertical-footer.svg" alt="">
    </div>
    <div class="card">
      <div class="cima">
        <p class="Titulo">Contato</p>
          <a href="./Formulário.html">•Email</a><br>
          <a href="./Formulário.html">•Formulário</a>
        </p>
      </div>
    </div>
    <div class="vertical2">
      <img src="Imagens/footer/LinhaVertical-footer.svg" alt="">
    </div>
    <div class="card">
      <div class="cima">
        <p class="Titulo">Sobre o projeto</p>
        <p class="textoPrincipal">
          •Desenvolvido por: <a href="https://www.linkedin.com/in/gabriel-furtado-165aa72bb/">Gabriel Furtado</a><br>
          •Instituição: <a href="https://sptech.school/">São Paulo tech school</a><br>
          <a
            href="https://bandteccom-my.sharepoint.com/:w:/g/personal/gabriel_dsousa_sptech_school/ETqZHxX_WZRAosnKsa7ZKWoBycfvJnAFzxgmrulGgwWgwA?e=OjjrFT">•Documentação
            do projeto</a>
        </p>
      </div>
    </div>
    <div class="horizontal"></div>
    <div class="baixo">
      <p class="disclaimer"> © 2025 Leitura Descomplicada - Todos os direitos reservados
        Projeto acadêmico desenvolvido para o curso de Ciências da Computação</p>
     </div>   
  </div>
  </body>
  <script>
  window.onload = function(){
    iconePerfil()
  }

  function iconePerfil(){
    if (sessionStorage.getItem('ID_USUARIO')){
    const perfil = document.getElementById("perfil")
    const div_perfil = document.getElementById("div_perfil")
    const nickname = document.getElementById("nickname")
    const email = document.getElementById("emailUser")
      perfil.src="Imagens/Navbar/perfil-circulo.svg"
      div_perfil.classList.add("container-perfil")
      nickname.innerHTML = sessionStorage.getItem("NOME_USUARIO")
      email.innerHTML = sessionStorage.getItem("EMAIL_USUARIO")
    }else {
      alert('Para utilizar as funcionalidades do Leitura descomplicada você deve estar logado!')
      window.location.href = "./Login.html"
    }
  }


  function deslogar(){
    sessionStorage.clear()
    window.location.href = "./Login.html"
  }
</script>
  <script>
    let indexDaVez = 0

let nomesLivro = [
  "Como Fazer Amigos e Influenciar Pessoas",
  "O Alquimista",
  "1984",
  "Admirável Mundo Novo",
  "A Morte do Caixeiro-Viajante",
  "O Hobbit",
  "Neuromancer",
  "O Nome da Rosa",
  "Em Busca de Sentido",
  "Cem Anos de Solidão",
  "O Iluminado",
  "A Paciente Silenciosa"
];

let capasLivro = [
  "Imagens/Carrossel/Como fazer amigos.jpg",
  "Imagens/Carrossel/OAlquimista.jpg",
  "Imagens/Carrossel/1984-Capa.jpg",
  "Imagens/Carrossel/Admirável Mundo Novo.jpg", 
  "Imagens/Carrossel/A Morte do Caixeiro-Viajante_.jpg", 
  "Imagens/Carrossel/O Hobbit.jpg", 
  "Imagens/Carrossel/Neuromancer.jpg", 
  "Imagens/Carrossel/O Nome da Rosa.jpg", 
  "Imagens/Carrossel/Em Busca de Sentido.jpg", 
  "Imagens/Carrossel/Cem Anos de Solidão.jpg", 
  "Imagens/Carrossel/O Iluminado.jpg", 
  "Imagens/Carrossel/A Paciente Silenciosa.jpg"  
];

let GenerosLivro = [
  "Não ficção",
  "Aventura",
  "Distopia",
  "Distopia",
  "Drama",
  "Fantasia",
  "Ficção Científica",
  "Ficção Histórica",
  "Não Ficção",
  "Romance",
  "Terror",
  "Suspense"
];

let descricoesLivro = [
  "Descubra o poder transformador das palavras e atitudes em um guia leve e prático que já mudou a vida de milhões. Com histórias reais e dicas simples, este livro revela como se conectar com qualquer pessoa — seja no trabalho, nos estudos ou no dia a dia — e mostra que a chave para abrir portas está na forma como tratamos os outros.",
  "Embarque em uma jornada mágica com Santiago, um jovem pastor que segue os sinais do destino em busca de um tesouro escondido. O que ele encontra, porém, vai muito além do ouro. Com uma linguagem simples e profunda, este livro fala sobre sonhos, propósito e as surpresas que o universo guarda para quem ousa escutá-lo.",
  "Imagine viver em um lugar onde até seus pensamentos podem ser vigiados. Em um mundo cinza e controlado por uma força invisível, Winston Smith se arrisca a desafiar o sistema. Este clássico não é apenas uma ficção — é um alerta, um suspense psicológico e uma leitura que prende do começo ao fim, fazendo você questionar o que é liberdade de verdade.",
  "Uma visão satírica de uma sociedade futura tecnologicamente avançada, onde os indivíduos são geneticamente condicionados e controlados por meio de prazeres artificiais e drogas.", 
  "A peça acompanha os últimos dias de Willy Loman, um vendedor viajante que confronta seus sonhos desfeitos e a realidade de seus relacionamentos familiares.", 
  "Bilbo Bolseiro, um hobbit pacato, é levado por Gandalf e um grupo de anões em uma aventura para recuperar um tesouro guardado por um dragão.", 
  "Um hacker talentoso, mas em desgraça, é contratado para uma última missão que o leva a confrontar inteligências artificiais poderosas e segredos corporativos.", 
  "Em um mosteiro italiano do século XIV, um frade franciscano investiga uma série de mortes misteriosas, envolvendo manuscritos antigos e segredos obscuros.", 
  "Um psiquiatra judeu relata suas experiências nos campos de concentração nazistas e desenvolve uma abordagem psicoterapêutica focada na busca por significado na vida.", 
  "A saga multigeneracional da família Buendía na cidade fictícia de Macondo, repleta de eventos fantásticos, paixões intensas e o peso da história.", 
  "Um escritor com problemas de alcoolismo aceita um emprego como zelador de inverno em um hotel isolado nas montanhas, onde forças sobrenaturais sinistras começam a afetar sua sanidade e sua família.", 
  "Uma psicoterapeuta tenta desvendar o mistério por trás do silêncio de sua paciente, uma artista que assassinou o marido e nunca mais pronunciou uma palavra."  
];

let tamanhoLeituraHoras = [
  "5 horas e 50 minutos",
  "3 horas e 25 minutos",
  "7 horas e 20 minutos",
  "8 horas e 15 minutos",  
  "2 horas e 30 minutos",  
  "9 horas e 0 minutos",  
  "7 horas e 45 minutos",  
  "14 horas e 0 minutos", 
  "6 horas e 0 minutos",  
  "10 horas e 30 minutos", 
  "11 horas e 0 minutos", 
  "9 horas e 30 minutos"   
];

let tamanhoLeituraHorasNumerico = [5.83, 3.42, 7.33, 8.25, 2.5, 9.0, 7.75, 14.0, 6.0, 10.5, 11.0, 9.5];

let ultimoNumeroGerado = null

    function numeroAleatorio(){
      let tamanhoLista = nomesLivro.length;
    let novoNumero;

    do {
        // Gera número entre 0 e tamanhoLista-1 (inclusivo)
        novoNumero = Math.floor(Math.random() * tamanhoLista);
    } while (novoNumero === ultimoNumeroGerado);

    // Armazenar o número gerado para a próxima verificação
    ultimoNumeroGerado = novoNumero;
    
    return novoNumero;
}

    

    function sorteio() {
      
      let numeroAletório = numeroAleatorio()
      let numeroAnterior = ''

      indexDaVez = numeroAletório
      
      console.log(numeroAletório);

      let imgExibida = document.getElementById("img_livro");
      let tituloExibido = document.getElementById("p_Titulo");
      let subtituloExibido = document.getElementById("p_subtitulo");
      let descricaoExibida = document.getElementById("p_descricao");
      let tamanhoLeituraHorasExibida = document.getElementById(
        "p_tempoLeituraHoras"
      );
      let btn_lista = document.getElementById("btn_lista");

      // mudando a exibição

      imgExibida.src = capasLivro[numeroAletório];
      tituloExibido.innerHTML = nomesLivro[numeroAletório];
      subtituloExibido.innerHTML = GenerosLivro[numeroAletório];
      descricaoExibida.innerHTML = descricoesLivro[numeroAletório];
      tamanhoLeituraHorasExibida.innerHTML = `Tempo medio de leitura: ${tamanhoLeituraHoras[numeroAletório]}`;
      btn_lista.style.display = "block";

      // mudando o tamanho e a mensagem do botão
      let botaoEscolhido = document.getElementById("botao");
      botaoEscolhido.style.width = "max-content";
      botaoEscolhido.style.height = "10vh";
      botaoEscolhido.style.fontSize = "1.7rem";
      botaoEscolhido.style.padding = "1.3rem";
      botaoEscolhido.innerHTML = "Sortear Novamente";
      botaoEscolhido.style.gridRow = "-1";

      // limpando a mensagem de adicionado quando sortear novamente 
      document.getElementById("p_respostaQuestionario").innerHTML = ''

      // mudando o tamanho da imagem
      imgExibida.style.height = "20vw";
      imgExibida.style.marginLeft = "2rem";
      imgExibida.style.marginRight = "2rem";
      imgExibida.style.boxShadow = "0px 4px 9px 2px rgba(0, 0, 0, 0.3)";

      // modificando a div card
      let divEscolhida = document.getElementById("cardCarrossel");
      console.log(divEscolhida);
      divEscolhida.style.padding = "2rem";
      divEscolhida.style.opacity = "1";

      window.scrollTo(0, 110);
      
    }

    function salvarLista() {
      
        let botaoSorteio = document.getElementById('botao');
        let cardCarrosselDiv = document.getElementById('cardCarrossel');
        let tituloParagrafo = document.getElementById('p_Titulo');
        let imagemLivro = document.getElementById('img_livro');
        let genero = document.getElementById('p_subtitulo');
        let descricao = document.getElementById('p_descricao');
        let botaoSalvarLista = document.getElementById('btn_lista');
  
    const id = sessionStorage.getItem("ID_USUARIO") || null;

    if (id == null){
      alert ('Você precisa estar logado para adicionar este livro a sua lista!')
      window.location.href = "./Login.html";
    }else{

    const divResposta = document.getElementById("p_respostaQuestionario")

     

    const dadosParaApi = {      
        "tituloParagrafoServer": tituloParagrafo.innerHTML,
        "imagemLivroServer": imagemLivro.src,                                
        "generoServer": genero.innerHTML,
        "descricaoServer": descricao.innerHTML,
        "tempoLeituraServer": tamanhoLeituraHorasNumerico[indexDaVez],
        "idServer": id,
    };

    // Tentar a conversão para JSON e ver se há erros
    const jsonString = JSON.stringify(dadosParaApi);
    
    
    console.log("Objeto original:", dadosParaApi);
    console.log("JSON convertido:", jsonString);

    console.log('Dados que serão enviados para a API:', dadosParaApi);
  
  
  const urlApi = `http://localhost:3333/favoritos/enviar`;
  
  
  divResposta.innerHTML = `<p style="color: blue;" class="erro">Processando Mensagem...</p>`;
  
  fetch(urlApi, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(dadosParaApi) // Converte o objeto para uma string JSON
  })
  .then(response => {
    // Primeiro verifica se a resposta é ok
    if (!response.ok) {
      return response.json().then(erroApi => {
        const mensagemErro = erroApi.mensagem || `Erro ao enviar: ${response.status}`;
        throw new Error(mensagemErro);
      }).catch(error => {
        // Se não conseguir obter json, ainda mostra um erro genérico
        throw new Error(`Erro ao enviar: ${response.status}`);
      });
    }
    return response.json();
  })
  .then(data => {
    console.log("Sucesso do cadastro:", data);
    divResposta.innerHTML = `<p style="color: green;"  class="erro">${data.mensagem || "Adicionado a sua lista com sucesso!"}</p>`;
              
            setTimeout(() => {
              divResposta.innerHTML = ''
            }, 3000);
    
    

  })
  .catch(error => {
    console.error("Erro geral no fetch:", error);
    if (error.message == 'Erro ao enviar: 500'){
      divResposta.innerHTML = `<p style="color: red;" class="erro">Este livro ja está na sua lista!</p>`
    }else 
    divResposta.innerHTML = `<p style="color: red;"  class="erro">"Ocorreu um erro ao adicionar esse livro a sua lista. Tente novamente mais tarde, ou, mande uma mensagem para nós através do formulário."
    </p>`;
    
     setTimeout(() => {
              divResposta.innerHTML = ''
            
            
            }, 3000);
  });
}
}   
  </script>
</html>
